modules:
  - name: ev-charging
    version: ">=1.0.0"
    import: "celine.dt.modules.ev_charging.module:module"
    enabled: true

    defaults: {}

    values:
      dwd_solar_energy:
        client: dataset_api
        query: |
          WITH latest_run AS (
            SELECT max(run_time_utc) AS run_time_utc
            FROM datasets.ds_dev_gold.dwd_icon_d2_solar_energy
            WHERE run_time_utc <= :start
              AND lat BETWEEN :lat_min AND :lat_max
              AND lon BETWEEN :lon_min AND :lon_max
          )
          SELECT
            run_time_utc,
            interval_end_utc,
            lat,
            lon,
            solar_energy_kwh_per_m2
          FROM datasets.ds_dev_gold.dwd_icon_d2_solar_energy
          WHERE run_time_utc = (SELECT run_time_utc FROM latest_run)
            AND interval_end_utc > :start
            AND interval_end_utc <= :end
            AND lat BETWEEN :lat_min AND :lat_max
            AND lon BETWEEN :lon_min AND :lon_max
          ORDER BY interval_end_utc
        limit: 5000
        payload:
          type: object
          required: [start, end, lat_min, lat_max, lon_min, lon_max]
          additionalProperties: false
          properties:
            start:
              type: string
            end:
              type: string
            lat_min:
              type: number
            lat_max:
              type: number
            lon_min:
              type: number
            lon_max:
              type: number

      weather_hourly_by_location:
        client: dataset_api
        query: |
          SELECT
            ts,
            clouds,
            uvi,
            weather_main,
            weather_description
          FROM datasets.ds_dev_gold.folgaria_weather_hourly
          WHERE ts >= :start
            AND ts < :end
            AND location_id = :location_id
          ORDER BY ts
        limit: 10000
        payload:
          type: object
          required: [start, end, location_id]
          additionalProperties: false
          properties:
            start:
              type: string
            end:
              type: string
            location_id:
              type: string

      weather_hourly_by_bbox:
        client: dataset_api
        query: |
          SELECT
            ts,
            clouds,
            uvi,
            weather_main,
            weather_description
          FROM datasets.ds_dev_gold.folgaria_weather_hourly
          WHERE ts >= :start
            AND ts < :end
            AND lat BETWEEN :lat_min AND :lat_max
            AND lon BETWEEN :lon_min AND :lon_max
          ORDER BY ts
        limit: 10000
        payload:
          type: object
          required: [start, end, lat_min, lat_max, lon_min, lon_max]
          additionalProperties: false
          properties:
            start:
              type: string
            end:
              type: string
            lat_min:
              type: number
            lat_max:
              type: number
            lon_min:
              type: number
            lon_max:
              type: number

ontology:
  active: "celine"
